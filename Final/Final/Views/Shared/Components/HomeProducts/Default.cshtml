@using Service.ViewModels.Product
@model IEnumerable<ProductVM>

@foreach (var product in Model)
{
    <div class="shop-card">

        @if (product.DiscountPrice != null)
        {
            var percent = (int)((product.Price - product.DiscountPrice.Value) / product.Price * 100);
            <div class="discount">-@percent%</div>
        }

        <div class="shop-img">
            <a asp-controller="Shop"
               asp-action="Detail"
               asp-route-id="@product.Id">
                <img src="~/admin/uploads/products/@product.Image" alt="@product.Name">
            </a>

            <div class="shop-icons">
                <a asp-controller="Shop"
                   asp-action="Detail"
                   asp-route-id="@product.Id">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </a>
                <i class="fa-solid fa-cart-shopping"></i>
            </div>
        </div>

        <div class="shop-info">
            <h3>@product.Name</h3>
            <div class="stars">
                @{
                    int fullStars = (int)product.AverageRating;
                    bool halfStar = product.AverageRating - fullStars >= 0.5;
                }

                @for (int i = 0; i < fullStars; i++)
                {
                    <span>★</span>
                }

                @if (halfStar)
                {
                    <span>★</span>
                }

                @for (int i = fullStars + (halfStar ? 1 : 0); i < 5; i++)
                {
                    <span>☆</span>
                }
            </div>
            <div class="price">
                @if (product.DiscountPrice != null)
                {
                    <span class="new">$@product.DiscountPrice</span>
                    <span class="old">$@product.Price</span>
                }
                else
                {
                    <span class="new">$@product.Price</span>
                }
            </div>

            <p class="stock @(product.InStock ? "" : "out")">
                <i class="fa-solid fa-circle"></i>
                @(product.InStock ? "In Stock" : "Out of Stock")
            </p>

            <div class="cart">
                <input type="number"
                       class="add-qty"
                       value="1"
                       min="1"
                       max="@product.Quantity">
                <button class="add-to-cart" @(product.InStock ? "" : "disabled") data-id="@product.Id">
                    ADD TO CART
                </button>
            </div>
        </div>

    </div>
}
