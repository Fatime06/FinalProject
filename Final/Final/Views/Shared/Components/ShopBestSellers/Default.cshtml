@using Service.ViewModels.Product
@model IEnumerable<ProductVM>

<section class="best-seller-box">
    <h3 class="best-seller-title">Best Seller</h3>
    <hr class="best-line">

    @foreach (var product in Model)
    {
        <div class="best-seller-item">

            <a asp-controller="Shop"
               asp-action="Detail"
               asp-route-id="@product.Id">
                <img src="~/admin/uploads/products/@product.Image" alt="@product.Name">
            </a>

            <div class="best-info">
                <h4>
                    <a asp-controller="Shop"
                       asp-action="Detail"
                       asp-route-id="@product.Id">
                        @product.Name
                    </a>
                </h4>

                <div class="stars">
                    @{
                        int fullStars = (int)product.AverageRating;
                        bool halfStar = product.AverageRating - fullStars >= 0.5;
                    }
                    @for (int i = 0; i < fullStars; i++)
                    {
                        <span>★</span>
                    }
                    @if (halfStar)
                    {
                        <span>★</span>
                    }
                    @for (int i = fullStars + (halfStar ? 1 : 0); i < 5; i++)
                    {
                        <span>☆</span>
                    }
                </div>

                <p class="best-price">
                    @if (product.DiscountPrice != null)
                    {
                        <span>$@product.DiscountPrice</span>
                    }
                    else
                    {
                        <span>$@product.Price</span>
                    }
                </p>

                <p class="best-stock @(product.InStock ? "" : "out")">
                    <i class="fa-solid fa-circle"></i>
                    @(product.InStock ? "In Stock" : "Out of Stock")
                </p>
            </div>
        </div>
    }
</section>
