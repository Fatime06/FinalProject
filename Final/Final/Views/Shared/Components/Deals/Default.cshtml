@using Service.ViewModels.Product
@model IEnumerable<ProductVM>

<section id="deals">
    <h2>Deals of the Week</h2>
    <p class="subtitle">
        View the latest deals and save | <a href="#">View All <i class="fa-solid fa-arrow-right"></i></a>
    </p>

    <div class="deal-container">

        @foreach(var product in Model)
        {
            <div class="deal-card">
                @if (product.DiscountPrice != null)
                {
                    var percent = (int)((product.Price - product.DiscountPrice.Value) / product.Price * 100);
                    <div class="discount">-@percent%</div>
                }
                <div class="deal-img">
                    <img src="~/admin/uploads/products/@product.Image" alt="">
                    <div class="icons">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <i class="fa-solid fa-cart-shopping"></i>
                    </div>
                </div>
                <div class="deal-info">
                    <h3>@product.Name</h3>

                    <div class="stars">
                        @{
                            int fullStars = (int)product.AverageRating;
                            bool halfStar = product.AverageRating - fullStars >= 0.5;
                        }

                        @for (int i = 0; i < fullStars; i++)
                        {
                            <span>★</span>
                        }

                        @if (halfStar)
                        {
                            <span>★</span>
                        }

                        @for (int i = fullStars + (halfStar ? 1 : 0); i < 5; i++)
                        {
                            <span>☆</span>
                        }
                    </div>

                    <div class="price">
                        <span class="new">$@product.DiscountPrice</span>
                        <span class="old">$@product.Price</span>
                    </div>

                    <p class="stock @(product.InStock ? "" : "out")">
                        <i class="fa-solid fa-circle"></i>
                        @(product.InStock ? "In Stock" : "Out of Stock")
                    </p>

                    <div class="cart">
                        <input type="number"
                               class="add-qty"
                               value="1"
                               min="1"
                               max="@product.Quantity">
                        <button class="add-to-cart" @(product.InStock ? "" : "disabled") data-id="@product.Id">
                            ADD TO CART
                        </button>
                    </div>
                </div>

            </div>
        }
    </div>
</section>
